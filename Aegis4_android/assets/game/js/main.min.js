var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},__extends=function(t,e){function i(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;n>i;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},__rest=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(i[n[r]]=t[n[r]]);return i},__decorate=function(t,e,i,n){var r,a=arguments.length,s=3>a?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var o=t.length-1;o>=0;o--)(r=t[o])&&(s=(3>a?r(s):a>3?r(e,i,s):r(e,i))||s);return a>3&&s&&Object.defineProperty(e,i,s),s},__param=function(t,e){return function(i,n){e(i,n,t)}},__metadata=function(t,e){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(t,e):void 0},__awaiter=function(t,e,i,n){function r(t){return t instanceof i?t:new i(function(e){e(t)})}return new(i||(i=Promise))(function(i,a){function s(t){try{h(n.next(t))}catch(e){a(e)}}function o(t){try{h(n["throw"](t))}catch(e){a(e)}}function h(t){t.done?i(t.value):r(t.value).then(s,o)}h((n=n.apply(t,e||[])).next())})},__generator=function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,a&&(s=2&i[0]?a["return"]:i[0]?a["throw"]||((s=a["return"])&&s.call(a),0):a.next)&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,a=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],a=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,a,s,o,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},__exportStar=function(t,e){for(var i in t)"default"===i||e.hasOwnProperty(i)||__createBinding(e,t,i)},__createBinding=Object.create?function(t,e,i,n){void 0===n&&(n=i),Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]},__values=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,a=i.call(t),s=[];try{for(;(void 0===e||e-->0)&&!(n=a.next()).done;)s.push(n.value)}catch(o){r={error:o}}finally{try{n&&!n.done&&(i=a["return"])&&i.call(a)}finally{if(r)throw r.error}}return s},__spread=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},__spreadArrays=function(){for(var t=0,e=0,i=arguments.length;i>e;e++)t+=arguments[e].length;for(var n=Array(t),r=0,e=0;i>e;e++)for(var a=arguments[e],s=0,o=a.length;o>s;s++,r++)n[r]=a[s];return n},__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t)},__asyncGenerator=function(t,e,i){function n(t){c[t]&&(l[t]=function(e){return new Promise(function(i,n){u.push([t,e,i,n])>1||r(t,e)})})}function r(t,e){try{a(c[t](e))}catch(i){h(u[0][3],i)}}function a(t){t.value instanceof __await?Promise.resolve(t.value.v).then(s,o):h(u[0][2],t)}function s(t){r("next",t)}function o(t){r("throw",t)}function h(t,e){t(e),u.shift(),u.length&&r(u[0][0],u[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,c=i.apply(t,e||[]),u=[];return l={},n("next"),n("throw"),n("return"),l[Symbol.asyncIterator]=function(){return this},l},__asyncDelegator=function(t){function e(e,r){i[e]=t[e]?function(i){return(n=!n)?{value:__await(t[e](i)),done:"return"===e}:r?r(i):i}:r}var i,n;return i={},e("next"),e("throw",function(t){throw t}),e("return"),i[Symbol.iterator]=function(){return this},i},__asyncValues=function(t){function e(e){n[e]=t[e]&&function(n){return new Promise(function(r,a){n=t[e](n),i(r,a,n.done,n.value)})}}function i(t,e,i,n){Promise.resolve(n).then(function(e){t({value:e,done:i})},e)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),n={},e("next"),e("throw"),e("return"),n[Symbol.asyncIterator]=function(){return this},n)},__makeTemplateObject=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},__setModuleDefault=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t["default"]=e},__importStar=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&__createBinding(e,t,i);return __setModuleDefault(e,t),e},__importDefault=function(t){return t&&t.__esModule?t:{"default":t}},__classPrivateFieldGet=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)},__classPrivateFieldSet=function(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,i),i},__reflect=function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i};!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var r in t)e.d(n,r,function(e){return t[e]}.bind(null,r));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){i(1),i(2),i(3),i(0),i(4),i(5),i(6),i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(14),i(15),i(16),i(17),i(18),i(19),i(20),i(21),i(22),i(23),i(24),i(25),i(26),i(27),i(28),i(29),i(30),i(31),i(32),i(33),i(34),i(35),i(36),i(37),i(38),i(39);var n=function(t){function e(){var e=t.call(this)||this;return e.mapEditor=""!=egret.getOption("map"),e.stageName=egret.getOption("stage"),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return this.touchEnabled=!0,[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=i.sent(),this.startAnimation(t),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return e=i.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){if(LifecycleCallback.regist(),this.mapEditor){var t=new MapEditor;return""!=this.stageName?t.loadMap(this.stageName):t.newMap(),void this.addChild(t)}this.toTitle()},e.prototype.toTitle=function(t){void 0===t&&(t=null);var e=new TitleScene;this.stage.addChild(e),e.addEventListener(PlayEvent.START,this.toStage,this),this.currentScene=e},e.prototype.toStage=function(t){void 0===t&&(t=null),this.currentScene&&(this.currentScene.dispose(),this.stage.removeChild(this.currentScene)),""==this.stageName&&(this.stageName="stage1");var e=new StageScene;e.play(this.stageName),this.currentScene=e,this.stage.addChild(e)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){},e}(egret.DisplayObjectContainer);window.Main=n,__reflect(n.prototype,"Main",[])},function(t,e){var i;!function(t){t[t.LAND=0]="LAND",t[t.AIR=1]="AIR"}(i||(i={})),window.Movement=i;var n=function(){function t(){}return t.AIR=0,t.LAND=1,t.LAND_KAIJU=2,t.AIR_KAIJU=3,t.LAND_KIHEI=4,t.AIR_KIHEI=5,t}();window.MapCellType=n,__reflect(n.prototype,"MapCellType",[]);var r;!function(t){t[t.CIRCLE=0]="CIRCLE",t[t.FAN=1]="FAN",t[t.LINE=2]="LINE"}(r||(r={})),window.RangeType=r;var a;!function(t){t[t.SPARE=0]="SPARE",t[t.WAIT_CONFIRM=1]="WAIT_CONFIRM",t[t.ACTION=2]="ACTION"}(a||(a={})),window.PlayPhase=a;var s;!function(t){t[t.JUMP_ATTACK=0]="JUMP_ATTACK",t[t.RAIL_GUN=1]="RAIL_GUN",t[t.MISSILE=2]="MISSILE",t[t.MULT_MISSILE=3]="MULT_MISSILE"}(s||(s={})),window.KiheiSkill=s;var o=function(){function t(){}return t.START="START",t.RETRY="RETRY",t.CLEAR="CLEAR",t.GAME_OVER="GAME_OVER",t.KIHEI_ACTION="KIHEI_ACTION",t.KIHEI_ACTION_DID="KIHEI_ACTION_DID",t.KIHEI_ACTION_FINISH="KIHEI_ACTION_FINISH",t.GET_DAMAGE="GET_DAMAGE",t.KAIJU_EXIT="KAIJU_EXIT",t.KAIJU_DESTROYED="KAIJU_DESTROYED",t.AEGIS_EMP="AEGIS_EMP",t.AEGIS_MAINTAIN="AEGIS_MAINTAIN",t.AEGIS_EMP_DID="AEGIS_EMP_DID",t.AEGIS_EMP_FINISH="AEGIS_EMP_FINISH",t.AEGIS_MAINTAIN_FINISH="AEGIS_MAINTAIN_FINISH",t.AEGIS_DAMAGE="AEGIS_DAMAGE",t.STATUS_INITED="STATUS_INITED",t}();window.PlayEvent=o,__reflect(o.prototype,"PlayEvent",[])},function(t,e){var i=function(){function t(){}return t.getRotation=function(t,e,i,n){var r=Math.atan((n-e+.1)/(i-t+.1)),a=r/(Math.PI/180);return t>i&&(a=-(180-a)),a},t.random=function(t,e){return Math.random()*(e-t)+t},t.getMc=function(t,e){void 0===e&&(e=-1);var i=RES.getRes(t+"_json"),n=RES.getRes(t+"_png"),r=new egret.MovieClipDataFactory(i,n),a=new egret.MovieClip(r.generateMovieClipData());return a},t.loadImage=function(t,e,i,n){var r=new egret.ImageLoader;r.crossOrigin="anonymous",r.load(t),r.once(egret.Event.COMPLETE,i,e),r.once(egret.IOErrorEvent.IO_ERROR,n,e)},t.httpReq=function(t,e,i,n,r,a,s,o){"GET"==i&&(t=t+"?"+e);var h=new egret.HttpRequest;h.open(t,i),h.setRequestHeader("Accept","*/*"),o&&h.setRequestHeader("Authorization",o),h.setRequestHeader("Content-Type",s),"GET"==i?h.send():h.send(e),h.addEventListener(egret.Event.COMPLETE,r,n),null!=a&&(h.addEventListener(egret.IOErrorEvent.IO_ERROR,a,n),h.addEventListener(egret.HTTPStatusEvent.CLOSE,a,n))},t.Loaded=function(){window.parent.postMessage({isLoadComplete:!0,url:window.location.href},"*")},t}();window.GlobalMethod=i,__reflect(i.prototype,"GlobalMethod",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);window.LoadingUI=i,__reflect(i.prototype,"LoadingUI",["RES.PromiseTaskReporter"])},function(t,e){var i=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();window.DebugPlatform=i,__reflect(i.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new i)},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!0,e}return __extends(e,t),e.prototype.boot=function(){this.HP=this.maxHP},e.prototype.move=function(){},e.prototype.action=function(t){},e.prototype.damage=function(t){this.HP-=t,this.HP<=0},e.prototype.isAir=function(){return this.air},e.prototype.setHP=function(t){this.HP=t},e.prototype.changeHP=function(t){var e=this.HP+t;0>e?e=0:e>this.maxHP&&(e=this.maxHP),this.HP=e},e.prototype.getHP=function(){return this.HP},e.prototype.getMaxHP=function(){return this.maxHP},e.prototype.getHPrate=function(){return Math.floor(this.HP/this.maxHP*100)},e}(egret.Sprite);window.BaseCharacter=i,__reflect(i.prototype,"BaseCharacter",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e._fps=egret.MainContext.instance.stage.frameRate,e.maxHP=800,e}return __extends(e,t),e.prototype.damage=function(t){this.HP-=t,this.HP<=0?(this.HP=0,this.dispatchEvent(new egret.Event(PlayEvent.GAME_OVER))):this.dispatchEvent(new egret.Event(PlayEvent.AEGIS_DAMAGE))},e.prototype.emp=function(t){this._empTimer=15*this._fps;for(var e=[],i=0,n=t;i<n.length;i++){var r=n[i];r.stun(),e.push(r)}this._empKaijus=e,this.dispatchEvent(new egret.Event(PlayEvent.AEGIS_EMP_DID))},e.prototype.refresh=function(){if(this._empTimer-=1,0==this._empTimer&&this._empKaijus){for(var t=0,e=this._empKaijus;t<e.length;t++){var i=e[t];i.stunFree()}this.dispatchEvent(new egret.Event(PlayEvent.AEGIS_EMP_FINISH))}},e.prototype.maintain=function(t){for(var e=0,i=t;e<i.length;e++){var n=i[e],r=n.getHP()+200,a=n.getMaxHP();r>a&&(r=a),n.setHP(r)}this.dispatchEvent(new egret.Event(PlayEvent.AEGIS_MAINTAIN_FINISH))},e}(BaseCharacter);window.Aegis=i,__reflect(i.prototype,"Aegis",[])},function(t,e){var i=function(){function t(t){this._arr=[],this._func=t}return t.prototype.getOne=function(){for(var t=null,e=0,i=this._arr;e<i.length;e++){var n=i[e];if(!n.activate){t=n;break}}return t||(t=this._func(),this._arr.push(t)),t.activate=!0,t},t.prototype.recycle=function(t){void 0===t&&(t=null);var e=t.target;e.activate=!1},t.prototype.dispose=function(){this._arr=null,this._func=null},t}();window.Pool=i,__reflect(i.prototype,"Pool",[])},function(t,e){var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.boot=function(){if(t.prototype.boot.call(this),this.arrived=!1,this.curRouteIndex=1,!this.sp){var e=this.drawKaiju();this.anchorOffsetX=e.width/2,this.anchorOffsetY=e.height/2,this.addChild(e),this.sp=e,this._w=this.width,this._h=this.height}this.x=this.mapCell.x,this.y=this.mapCell.y,this.createFilter()},e.prototype.drawKaiju=function(){return null},e.prototype.startMove=function(t){this.route=t,this.curRouteIndex=1},e.prototype.move=function(){if(null!=this.route&&!this.moveTween&&!this._stun){var t=this.route[this.curRouteIndex],e=t.x+Math.random()*t.width-t.width/2-this.anchorOffsetX,i=t.y+Math.random()*t.height-t.height/2-this.anchorOffsetY;this.curRouteIndex==this.route.length-1&&(i+=t.getSize()),this.moveTween=egret.Tween.get(this).to({x:e+this.anchorOffsetX,y:i+this.anchorOffsetY},this.speed).call(this.onMoveStep,this)}},e.prototype.onMoveStep=function(){return this.curRouteIndex++,this.curRouteIndex>=this.route.length?(this.mapCell=this.route[this.route.length-1],this.moveTween=null,this.route=null,this.arrived=!0,void this.dispatchEvent(new egret.Event(PlayEvent.KAIJU_EXIT))):(this.mapCell=this.route[this.curRouteIndex],void(this.moveTween=null))},e.prototype.aimed=function(t){if(t){if(this.aimTween)return;var e=new egret.GlowFilter(16777215,.1,20,20,25,1,!0,!1);this.air&&!this.stun?this.filters=[this.redFilter,this.shadowFilter,e]:this.filters=[this.redFilter,e],this.aimTween=egret.Tween.get(e,{loop:!0}).to({alpha:.8},500).to({alpha:.1},500)}else{if(!this.aimTween)return;this.air&&!this.stun?this.filters=[this.redFilter,this.shadowFilter]:this.filters=[this.redFilter],this.aimTween.pause(),this.aimTween=null}},e.prototype.getArrived=function(){return this.arrived},e.prototype.dispose=function(){this.filters=[],this.hpBar&&this.hpBar.parent&&this.hpBar.parent.removeChild(this.hpBar),this.parent&&this.parent.removeChild(this),this.moveTween&&this.moveTween.pause(),this.moveTween=null,this.aimTween&&this.aimTween.pause(),this.aimTween=null,this.route=null,this.activate=!1},e.prototype.pause=function(){this.moveTween&&this.moveTween.pause()},e.prototype.resume=function(){this._stun||this.moveTween&&this.moveTween.play()},e.prototype.getCollisionPoint=function(){var t=this.x-this.anchorOffsetX,e=this.y-this.anchorOffsetY,i=t+this._w,n=e+this._h;return[new egret.Point(t,e),new egret.Point(i,e),new egret.Point(t,n),new egret.Point(i,n)]},e.prototype.damage=function(t){var e=this;if(this.HP-=t,this.hpBar||(this.hpBar=new SimpleHPBar(this.getHPrate(),this._w),this.hpBar.x=0,this.hpBar.y=this._h+3),this.addChild(this.hpBar),this.hpBar.value=this.getHPrate(),this.HP<=0){var i=new particle.GravityParticleSystem(RES.getRes("kaijuslice1_png"),RES.getRes("kaijuslice1_json"));i.x=this.x,i.y=this.y,this.parent.addChild(i),i.start(200),i.addEventListener(egret.Event.COMPLETE,function(t){i.parent&&i.parent.removeChild(i),e.hpBar.parent&&e.hpBar.parent.removeChild(e.hpBar)},this),this.dispatchEvent(new egret.Event(PlayEvent.KAIJU_DESTROYED))}else{var n=new particle.GravityParticleSystem(RES.getRes("kaijuslice1_png"),RES.getRes("kaijuslice2_json"));n.x=this.x,n.y=this.y,this.parent.addChild(n),n.start(5),n.addEventListener(egret.Event.COMPLETE,function(t){n.parent&&n.parent.removeChild(n)},this),setTimeout(function(){e.hpBar.parent&&e.hpBar.parent.removeChild(e.hpBar)},2e3)}},e.prototype.stun=function(){this._stun=!0,this.air&&(this.filters=[this.redFilter]),this.pause()},e.prototype.stunFree=function(){this._stun=!1,this.air&&(this.filters=[this.redFilter,this.shadowFilter]),this.resume()},e.prototype.createFilter=function(){var t=new egret.GlowFilter(14483456,1,5,5,5);if(this.redFilter=t,this.air){var e=new egret.DropShadowFilter(10,45,null,.5);return this.shadowFilter=e,void(this.filters=[t,e])}this.filters=[t]},e.pool=new Pool(function(){var t=Math.random()<=.5,e=Math.random()<=.15;return t&&e?new Eagle:t&&!e?new Mosquito:!t&&e?new Bull:t||e?void 0:new Ant}),e}(BaseCharacter);window.Kaiju=i,__reflect(i.prototype,"Kaiju",["IPoolObject"])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.air=!1,e.maxHP=60,e.speed=500,e}return __extends(e,t),e.prototype.drawKaiju=function(){var t=this.mapCell.getSize(),e=new egret.Bitmap;e.texture=RES.getRes("character_json#ant");var i=e.width/e.height;return e.height=t,e.width=e.height*i,this.sp||this.addChild(e),e},e}(Kaiju);window.Ant=i,__reflect(i.prototype,"Ant",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.air=!1,e.maxHP=120,e.speed=400,e}return __extends(e,t),e.prototype.drawKaiju=function(){var t=this.mapCell.getSize(),e=new egret.Bitmap;e.texture=RES.getRes("character_json#bull");var i=e.width/e.height;return e.height=1.5*t,e.width=e.height*i,this.sp||this.addChild(e),e},e}(Kaiju);window.Bull=i,__reflect(i.prototype,"Bull",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.air=!0,e.maxHP=50,e.speed=350,e}return __extends(e,t),e.prototype.drawKaiju=function(){var t=this.mapCell.getSize(),e=new egret.Bitmap;e.texture=RES.getRes("character_json#mosqito");var i=e.width/e.height;return e.height=t,e.width=e.height*i,this.sp||this.addChild(e),e},e.prototype.startMove=function(t){this.route=t;var e=t[t.length-1],i=egret.Point.distance(new egret.Point(this.x,this.y),new egret.Point(e.x,e.y));this._sin=(e.y-this.y+.01)/i,this._cos=(e.x-this.x+.01)/i},e.prototype.move=function(){if(!this.moveTween&&!this._stun){var t=this.mapCell.getSize(),e=this.x+this._cos*t,i=this.y+this._sin*t;this.moveTween=egret.Tween.get(this).to({x:e,y:i},this.speed).call(this.onMoveStep,this)}},e.prototype.onMoveStep=function(){if(null!=this.route){var t=this.route[this.route.length-1],e=Math.floor(this.x/t.getSize()),i=Math.floor(this.y/t.getSize()),n=World.getIns().cellArr;return this.mapCell=n[i][e],this.mapCell==t?(this.route=null,this.moveTween=null,this.arrived=!0,void this.dispatchEvent(new egret.Event(PlayEvent.KAIJU_EXIT))):void(this.moveTween=null)}},e}(Kaiju);window.Mosquito=i,__reflect(i.prototype,"Mosquito",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.air=!0,e.maxHP=100,e.speed=400,e}return __extends(e,t),e.prototype.getCollisionPoint=function(){var t=this.x-this.anchorOffsetX,e=this.y-this.anchorOffsetY,i=t+this._w,n=e+this._h,r=e+this._h/2;return[new egret.Point(t,e),new egret.Point(i,e),new egret.Point(t,r),new egret.Point(i,r),new egret.Point(t,n),new egret.Point(i,n)]},e.prototype.drawKaiju=function(){var t=this.mapCell.getSize(),e=new egret.Bitmap;e.texture=RES.getRes("character_json#eagle");var i=e.width/e.height;return e.height=4*t,e.width=e.height*i,this.sp||this.addChild(e),e},e}(Mosquito);window.Eagle=i,__reflect(i.prototype,"Eagle",[])},function(t,e){var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.boot=function(){t.prototype.boot.call(this);var e=this.drawKihei();e&&(this.anchorOffsetX=e.width/2,this.anchorOffsetY=e.height/2,this.addChild(e),this.sp=e,this.maxCD=-1,this.cd=this.maxCD,this.mountSkill())},e.prototype.startMove=function(t,e){this.route=t,this.curRouteIndex=1,this.targetPosition=e},e.prototype.stopMove=function(){this.route&&(this.mapCell=this.route[this.curRouteIndex],this.route=null,this.curRouteIndex=0,this.targetPosition=null,this.moveTween&&this.moveTween.pause(),this.moveTween=null)},e.prototype.move=function(){if(null!=this.route&&!this.moveTween){var t=this.route[this.curRouteIndex];this.moveTween=egret.Tween.get(this).to({x:t.x,y:t.y},100).call(this.onMoveStep,this)}},e.prototype.onMoveStep=function(){return this.curRouteIndex++,this.curRouteIndex>=this.route.length?(this.moveTween=egret.Tween.get(this).to({x:this.targetPosition.x,y:this.targetPosition.y},50),this.mapCell=this.route[this.route.length-1],this.moveTween=null,void(this.route=null)):(this.mapCell=this.route[this.curRouteIndex],void(this.moveTween=null))},e.prototype.showAttackRange=function(t){this.skills[0].showAttackRange(t)},e.prototype.showDamageRange=function(t,e,i){this.skills[0].showDamageRange(t,e,i)},e.prototype.checkKaijuInRange=function(t){return this.skills[0].checkInRange(t)},e.prototype.getActionTarget=function(){return this.skills[0].actionTarget},e.prototype.action=function(t){this.skills[0].action(t)},e.prototype.getAtk=function(){return this.skills[0].getATK()},e.prototype.mountSkill=function(t){if(void 0===t&&(t=null),!this.skills||0==this.skills.length)throw new Error("Kihei has no skill");return this.skills[0]},e.prototype.drawKihei=function(){return null},e.prototype.getAvaliable=function(){return this.cd==this.maxCD},e.prototype.startCD=function(t){this.maxCD=t,this.cd=0},e.prototype.onCD=function(){return this.cd==this.maxCD?(this.maxCD=-1,this.cd=-1,!0):(this.cd++,this.cd==this.maxCD)},e.prototype.getCDRate=function(){return this.cd/this.maxCD},e.prototype.pause=function(){this.moveTween&&this.moveTween.pause()},e.prototype.resume=function(){this.moveTween&&this.moveTween.play()},e.prototype.onSelect=function(t){if(t){var e=new egret.GlowFilter(16766720,.8,10,10,10,1,!1);this.sp.filters=[e]}else this.sp.filters=[]},e}(BaseCharacter);window.Kihei=i,__reflect(i.prototype,"Kihei",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.HP=500,e.maxHP=500,e.skills=[new JumpAttack(e)],e}return __extends(e,t),e.prototype.drawKihei=function(){var t=this.mapCell.getSize(),e=new egret.Bitmap;e.texture=RES.getRes("character_json#gen1");var i=e.width/e.height;return e.height=1.5*t,e.width=e.height*i,e.x=0,e.y=0,this.sp||this.addChild(e),e},e.prototype.checkDistance=function(t,e,i){return egret.Point.distance(new egret.Point(t.x,t.y),e)<=i},e}(Kihei);window.KiheiGen1=i,__reflect(i.prototype,"KiheiGen1",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.maxHP=350,e.skills=[new Missile(e)],e}return __extends(e,t),e.prototype.drawKihei=function(){var t=this.mapCell.getSize(),e=new egret.Bitmap;e.texture=RES.getRes("character_json#gen2");var i=e.width/e.height;return e.height=1.5*t,e.width=e.height*i,e.x=0,e.y=0,this.sp||this.addChild(e),e},e}(Kihei);window.KiheiGen2=i,__reflect(i.prototype,"KiheiGen2",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.maxHP=300,e.skills=[new RailGun(e)],e}return __extends(e,t),e.prototype.drawKihei=function(){var t=this.mapCell.getSize(),e=new egret.Bitmap;e.texture=RES.getRes("character_json#gen3");var i=e.width/e.height;return e.height=1.5*t,e.width=e.height*i,e.x=0,e.y=0,this.sp||this.addChild(e),e},e}(Kihei);window.KiheiGen3=i,__reflect(i.prototype,"KiheiGen3",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.maxHP=250,e.air=!0,e.skills=[new MultMissile(e)],e}return __extends(e,t),e.prototype.drawKihei=function(){var t=this.mapCell.getSize(),e=new egret.Bitmap;e.texture=RES.getRes("character_json#gen4");var i=e.width/e.height;return e.height=1.5*t,e.width=e.height*i,e.x=0,e.y=0,this.sp||this.addChild(e),e},e.prototype.startMove=function(t,e){this.route=t,this.targetPosition=e;var i=t[t.length-1],n=egret.Point.distance(new egret.Point(this.x,this.y),new egret.Point(i.x,i.y));this._sin=(i.y-this.y+.01)/n,this._cos=(i.x-this.x+.01)/n},e.prototype.move=function(){if(null!=this.targetPosition&&!this.moveTween){var t=this.mapCell.getSize(),e=this.x+this._cos*t,i=this.y+this._sin*t;this.moveTween=egret.Tween.get(this).to({x:e,y:i},100).call(this.onMoveStep,this)}},e.prototype.onMoveStep=function(){if(null!=this.route){var t=this.route[this.route.length-1],e=Math.floor(this.x/t.getSize()),i=Math.floor(this.y/t.getSize()),n=World.getIns().cellArr;return this.mapCell=n[i][e],this.mapCell==t?(this.moveTween=egret.Tween.get(this).to({x:this.targetPosition.x,y:this.targetPosition.y},50),this.targetPosition=null,this.route=null,void(this.moveTween=null)):void(this.moveTween=null)}},e}(Kihei);window.KiheiGen4=i,__reflect(i.prototype,"KiheiGen4",[])},function(t,e){var i=function(t){function e(e,i,n,r,a,s){var o=t.call(this)||this;o._start=new egret.Point(e,i),o._rotation=n,o._distance=r,o._cellSize=a,o._distance2=r*a,o._speed=s?s:72,o.draw(),o.x=e,o.y=i,o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2,o.rotation=n+90;var h=Math.cos(n)*o._distance2+e,l=Math.sin(n)*o._distance2+i;return o._target=new egret.Point(h,l),console.log(o._target,Math.sin(n),Math.cos(n)),o.launch(),o}return __extends(e,t),e.prototype.launch=function(){egret.Tween.get(this).to({x:this._target.x,y:this._target.y},5e3)},e.prototype.draw=function(){var t=new egret.Bitmap;t.texture=RES.getRes("missle_png");var e=t.height/t.width;t.width=.5*this._cellSize,t.height=e*t.width,console.log(t.width,t.height,e,t.height,t.width,this._cellSize),this.addChild(t)},e.prototype.drawTinyCube=function(){},e}(egret.Sprite);window.MissleEffect=i,__reflect(i.prototype,"MissleEffect",[])},function(t,e){var i=function(t){function e(e,i,n,r){void 0===r&&(r=null);var a=t.call(this)||this;return a.skinName="resource/eui_skins/GameResult.exml",a.addEventListener(eui.UIEvent.CREATION_COMPLETE,a.initData,a),a._clear=e,a._kaijuNum=i,a._aegisHP=n,a._callBack=r,a}return __extends(e,t),e.prototype.initData=function(){this._clear?(this.txt_type.text="Stage Clear",this.txt_kaiju_num.text=""+this._kaijuNum,this.txt_aegis_hp.text=this._aegisHP+"%"):(this.txt_type.text="Game Over",this.txt_kaiju_num.text=""+this._kaijuNum,this.txt_type2.visible=!1),this.btn_retry.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.width=egret.MainContext.instance.stage.stageWidth},e.prototype.dispose=function(){this.btn_retry.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.parent&&this.parent.removeChild(this)},e.prototype.onClick=function(t){this._callBack?this._callBack(t):this.dispatchEvent(new egret.Event(PlayEvent.CLEAR))},e}(eui.Component);window.GameResult=i,__reflect(i.prototype,"GameResult",[])},function(t,e){},function(t,e){var i=function(t){function e(e,i,n,r,a,s){void 0===r&&(r=MapCellType.AIR),void 0===a&&(a=!1),void 0===s&&(s=null);var o=t.call(this)||this;o._type=MapCellType.AIR,o.cellX=e,o.cellY=i,o._size=n,o._type=r,o._isEditor=a,o.nodes=s,o.touchEnabled=!0;var h=new egret.TextField;return h.width=n,h.height=n,h.size=n,o.addChild(h),o._label=h,o.refreshSprite(),a?o.addEventListener("touchTap",o.switchType,o):o.addEventListener(egret.Event.ADDED_TO_STAGE,o.getHitPoint,o),o}return __extends(e,t),e.prototype.switchType=function(t){void 0===t&&(t=null);var e=this._type;5==e?e=MapCellType.AIR:e+=1,this._type=e,this.refreshSprite()},e.prototype.getType=function(){return this._type},e.prototype.isLand=function(){return this._type==MapCellType.LAND||this._type==MapCellType.LAND_KIHEI||this._type==MapCellType.LAND_KAIJU},e.prototype.getSize=function(){return this._size},e.prototype.refreshSprite=function(){if(this.graphics.clear(),this._label.visible=!1,this._isEditor)switch(this._type){case MapCellType.AIR:this.graphics.beginFill(0),this.graphics.lineStyle(2,3329330);break;case MapCellType.LAND:this.graphics.beginFill(7707981);break;case MapCellType.LAND_KAIJU:this.graphics.beginFill(11020593),this._label.text="陆",this._label.visible=!0;break;case MapCellType.AIR_KAIJU:this.graphics.beginFill(11020593),this._label.text="空",this._label.visible=!0;break;case MapCellType.LAND_KIHEI:this.graphics.beginFill(3449317),this._label.text="陆",this._label.visible=!0;break;case MapCellType.AIR_KIHEI:this.graphics.beginFill(3449317),this._label.text="空",this._label.visible=!0}else switch(this._type){case MapCellType.AIR:case MapCellType.AIR_KAIJU:case MapCellType.AIR_KIHEI:this.graphics.beginFill(0,.5),this.graphics.lineStyle(2,3329330);break;default:this.graphics.beginFill(64154)}this.graphics.drawRect(0,0,this._size,this._size),this.graphics.endFill(),this.anchorOffsetX=this._size/2,this.anchorOffsetY=this._size/2},e.prototype.getHitPoint=function(t){if(void 0===t&&(t=null),!this._hitPoint){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.getHitPoint,this);var e=this.x,i=this.y,n=this._size/2;this._hitPoint=[new egret.Point(e-n,i-n),new egret.Point(e,i-n),new egret.Point(e+n,i-n),new egret.Point(e-n,i),new egret.Point(e+n,i),new egret.Point(e-n,i+n),new egret.Point(e,i+n),new egret.Point(e+n,i+n)]}return this._hitPoint},e.prototype.checkInRange=function(t){for(var e=this.getHitPoint(),i=0,n=e;i<n.length;i++){var r=n[i];
if(t.hitTestPoint(r.x,r.y))return!0}return!1},e}(egret.Sprite);window.MapCell=i,__reflect(i.prototype,"MapCell",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;e.ROW=20,e.COLUMN=12,e._stage=egret.MainContext.instance.stage;var i=e._stage;return e._cellSize=Math.floor(i.stageWidth/e.COLUMN),e.x=0,e.y=0,e.graphics.beginFill(0),e.graphics.drawRect(0,0,i.stageWidth,e._cellSize*e.ROW),e.graphics.endFill(),e.touchEnabled=!0,e}return __extends(e,t),e.prototype.newMap=function(){for(var t=this,e=[],i=this._cellSize,n=0;n<this.ROW;n++){for(var r=[],a=0;a<this.COLUMN;a++){var s=new MapCell(a,n,i,MapCellType.AIR,!0);s.x=a*i+i/2,s.y=n*i+i/2,r.push(s),this.addChild(s)}e.push(r)}this._cellArr=e,document.addEventListener("keydown",function(e){t.keydown(e)})},e.prototype.loadMap=function(t){var e=this,i=RES.getRes(t+"_json");if(null!=i){for(var n=[],r=i.data,a=this._cellSize,s=0;s<this.ROW;s++){for(var o=[],h=0;h<this.COLUMN;h++){var l=new MapCell(h,s,a,r[s][h],!0);l.x=h*a+a/2,l.y=s*a+a/2,o.push(l),this.addChild(l)}n.push(o)}this._cellArr=n,document.addEventListener("keydown",function(t){e.keydown(t)})}},e.prototype.keydown=function(t){13==t.keyCode&&this.generateMapData()},e.prototype.generateMapData=function(){for(var t=[],e=[],i=[],n={},r=0;r<this.ROW;r++){for(var a=[],s=0;s<this.COLUMN;s++){var o=this._cellArr[r][s],h=o.getType();if(a.push(h),h==MapCellType.AIR_KAIJU||h==MapCellType.LAND_KAIJU?i.push([r,s]):(h==MapCellType.LAND_KIHEI||h==MapCellType.AIR_KIHEI)&&e.push([r,s]),o.isLand()){var l=[];this._cellArr[r-1]&&this._cellArr[r-1][s].isLand()&&l.push([r-1,s]),this._cellArr[r+1]&&this._cellArr[r+1][s].isLand()&&l.push([r+1,s]),this._cellArr[r][s-1]&&this._cellArr[r][s-1].isLand()&&l.push([r,s-1]),this._cellArr[r][s+1]&&this._cellArr[r][s+1].isLand()&&l.push([r,s+1]),n[r+"_"+s]=l}}t.push(a)}var c={size:[this.ROW,this.COLUMN],data:t,nodes:n,kihei:e,kaiju:i};console.log(JSON.stringify(c))},e}(egret.Sprite);window.MapEditor=i,__reflect(i.prototype,"MapEditor",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e._stage=egret.MainContext.instance.stage,e._fps=egret.MainContext.instance.stage.frameRate,e.MAX_KAIJU_NUM=20,e.lastCalcPoint=4,e._kaijuBlastTimer=new egret.Timer(300),e._crashCheckCounter=0,e._routeDict=new RouteDict,e}return __extends(e,t),e.prototype.play=function(t){var e=this,i=RES.getRes(t+"_json");null!=i&&(console.log("关卡数据：",i),this._kaijuGenTicker=0,this._kaijuGenInterval=this._stage.frameRate,this._playPhase=PlayPhase.SPARE,this._destroyedKaijuNumber=0,this._timeLimit=190*this._fps,this._timePassed=0,this.initMap(i.data,i.size,i.nodes,i.kaiju),this.initKihei(i.kihei),this.initKaiju(),this.initUI(),setTimeout(function(){e.start()},1500))},e.prototype.start=function(){SoundManager.instance().play("edgebranched_mp3",!1),this.addEventListener("touchTap",this.onClick,this),this.addEventListener("touchBegin",this.onMouseDown,this),this.addEventListener("touchMove",this.onMouseMove,this),this.addEventListener("touchEnd",this.onMouseUp,this),this.addEventListener(egret.Event.ENTER_FRAME,this.refreshStage,this)},e.prototype.initMap=function(t,e,i,n){var r=this._stage.stageWidth/e[1];World.getIns().initMap(t,e,i,r,n);for(var a=World.getIns().cellArr,s=0;s<e[0];s++)for(var o=0;o<e[1];o++)this.addChild(a[s][o]);this._cellArr=a,this._cellSize=r;var h=new egret.Sprite;h.graphics.drawRect(0,0,this._stage.stageWidth,this._stage.stageHeight),this.addChild(h),this._landKaijuLayer=h;var l=new egret.Sprite;l.graphics.drawRect(0,0,this._stage.stageWidth,this._stage.stageHeight),this.addChild(l),this._landKiheiLayer=l;var c=new egret.Sprite;c.graphics.drawRect(0,0,this._stage.stageWidth,this._stage.stageHeight),this.addChild(c),this._airKaijuLayer=c;var u=new egret.Sprite;u.graphics.drawRect(0,0,this._stage.stageWidth,this._stage.stageHeight),this.addChild(u),this._airKiheiLayer=u},e.prototype.initKihei=function(t){var e=new Aegis;e.boot(),e.addEventListener(PlayEvent.GAME_OVER,this.onGameOver,this),this._aegis=e;var i=[];this._cellSize;if(t[0]){var n=new KiheiGen1,r=this._cellArr[t[0][0]][t[0][1]];n.x=r.x,n.y=r.y,n.mapCell=r,n.boot(),this._landKiheiLayer.addChild(n),i.push(n)}if(t[1]){var a=new KiheiGen2,r=this._cellArr[t[1][0]][t[1][1]];a.x=r.x,a.y=r.y,a.mapCell=r,a.boot(),this._landKiheiLayer.addChild(a),i.push(a)}if(t[3]){var s=new KiheiGen3,r=this._cellArr[t[3][0]][t[3][1]];s.x=r.x,s.y=r.y,s.mapCell=r,s.boot(),this._landKiheiLayer.addChild(s),i.push(s)}if(t[2]){var o=new KiheiGen4,r=this._cellArr[t[2][0]][t[2][1]];o.x=r.x,o.y=r.y,o.mapCell=r,o.boot(),this._airKiheiLayer.addChild(o),i.push(o)}this._kiheis=i},e.prototype.initKaiju=function(){this._kaijus=[];for(var t=0;10>t;t++)this.generateKaiju()},e.prototype.generateKaiju=function(){if(!(this._kaijus.length>=this.MAX_KAIJU_NUM)){var t=Kaiju.pool.getOne(),e=World.getIns().randomEntry(t.isAir()),i=World.getIns().randomExit(t.isAir());if(t.mapCell=e,t.boot(),t.isAir())t.startMove([i]);else{var n=this._routeDict.checkRoute2(e,i,!0);t.startMove(n.route)}t.addEventListener(PlayEvent.KAIJU_DESTROYED,this.onKaijuExit,this),t.addEventListener(PlayEvent.KAIJU_EXIT,this.onKaijuExit,this),this._kaijus.push(t),t.isAir()?this._airKaijuLayer.addChild(t):this._landKaijuLayer.addChild(t)}},e.prototype.initUI=function(){this._actConfirmButton=new ConfirmBtn;var t=new StatusBar(this._aegis,this._kiheis);t.width=this._stage.stageWidth,t.refreshTime(this._timeLimit),this.addChild(t),t.height=this._stage.stageHeight-t.height,t.addEventListener(PlayEvent.AEGIS_EMP,this.onAegisAction,this),t.addEventListener(PlayEvent.AEGIS_MAINTAIN,this.onAegisAction,this),this._statusBar=t},e.prototype.onClick=function(t){if(this._playPhase==PlayPhase.SPARE){var e;if(t.target instanceof MapCell?e=t.target:t.target instanceof BaseCharacter&&(e=t.target.mapCell),e&&this._curSelectedKihei&&e!=this._curSelectedKihei.mapCell){var i=this._curSelectedKihei;if(!e.isLand()&&!i.isAir())return console.log("地面单位无法移动到空中"),this._curSelectedKihei.onSelect(!1),this._curSelectedKihei=null,void(this._pause=!1);if(i.isAir())i.startMove([e],new egret.Point(t.stageX,t.stageY));else{var n=this._routeDict.checkRoute2(i.mapCell,e,!1);n.route.length>0&&i.startMove(n.route,new egret.Point(t.stageX,t.stageY))}this._curSelectedKihei.onSelect(!1),this._curSelectedKihei=null,this._pause=!1}}},e.prototype.onMouseDown=function(t){if(this._playPhase==PlayPhase.SPARE&&t.target instanceof Kihei){this._curSelectedKihei&&this._curSelectedKihei.onSelect(!1);var e=t.target;if(!e.getAvaliable())return void SoundManager.instance().playBgs("bgs_forbid_mp3");this._curSelectedKihei=t.target,this._curSelectedKihei.onSelect(!0),this._pause=!0}},e.prototype.onMouseMove=function(t){if(this._playPhase==PlayPhase.SPARE){if(this.lastCalcPoint%4!=0)return void this.lastCalcPoint++;if(this.lastCalcPoint=1,this._curSelectedKihei){var e=this._curSelectedKihei;if(this._isAction){e.showDamageRange(t.stageX,t.stageY,this._cellArr);for(var i=[],n=0,r=this._kaijus;n<r.length;n++){var a=r[n],s=e.checkKaijuInRange(a);s&&i.push(a),a.aimed(s)}this._curAimedKaiju=i}else(Math.abs(t.stageX-e.x)>this._cellSize/2||Math.abs(t.stageY-e.y)>this._cellSize/2)&&(e.showAttackRange(!0),this._isAction=!0)}}},e.prototype.onMouseUp=function(t){if(this.lastCalcPoint=1,this._playPhase!=PlayPhase.ACTION)if(this._playPhase!=PlayPhase.WAIT_CONFIRM){if(this._curSelectedKihei){var e=this._curSelectedKihei;if(e.showAttackRange(!1),this._isAction){this._playPhase=PlayPhase.WAIT_CONFIRM;var i=e.getActionTarget();if(null==i)return this._curSelectedKihei.onSelect(!1),this._curSelectedKihei=null,this._pause=!1,this._isAction=!1,void(this._playPhase=PlayPhase.SPARE);var n=this._actConfirmButton;n.x=(this._stage.stageWidth-n.width)/2,n.y=(this._stage.stageHeight-n.height)/2,console.log(this._stage.stageWidth,n.width,n.x),this.addChild(this._actConfirmButton)}}}else{if(t.target!=this._actConfirmButton){if(this._curSelectedKihei&&this._curSelectedKihei.showDamageRange(-1,-1,null),this._actConfirmButton.parent&&this._actConfirmButton.parent.removeChild(this._actConfirmButton),this._pause=!1,this._isAction=!1,this._playPhase=PlayPhase.SPARE,this._curSelectedKihei.onSelect(!1),this._curSelectedKihei=null,this._curAimedKaiju)for(var r=0,a=this._curAimedKaiju;r<a.length;r++){var s=a[r];s.aimed(!1)}return void(this._curAimedKaiju=[])}this._actConfirmButton.parent&&this._actConfirmButton.parent.removeChild(this._actConfirmButton);var e=this._curSelectedKihei;if(e.onSelect(!1),e.showDamageRange(-1,-1,this._cellArr),e.addEventListener(PlayEvent.KIHEI_ACTION_FINISH,this.onKiheiActionFinished,this),e.action(this._curAimedKaiju),this._playPhase=PlayPhase.ACTION,this._curAimedKaiju)for(var o=0,h=this._curAimedKaiju;o<h.length;o++){var s=h[o];s.aimed(!1)}}},e.prototype.onKiheiActionFinished=function(t){this._kaijuBlastTimer.addEventListener("timer",this.onKaijuBlast,this),this._kaijuBlastTimer.start()},e.prototype.onKaijuBlast=function(){var t=this._curAimedKaiju,e=this._curSelectedKihei;if(t&&t.length>0&&e){var i=t.pop();i.damage(e.getAtk())}else this._kaijuBlastTimer.removeEventListener("timer",this.onKaijuBlast,this),this._kaijuBlastTimer.stop(),this.onResumeStage()},e.prototype.onResumeStage=function(){this._playPhase=PlayPhase.SPARE,this._curSelectedKihei&&this._curSelectedKihei.removeEventListener(PlayEvent.KIHEI_ACTION_FINISH,this.onKiheiActionFinished,this),this._pause=!1,this._curSelectedKihei=null,this._isAction=!1},e.prototype.onKaijuExit=function(t){var e=t.target;t.type==PlayEvent.KAIJU_DESTROYED?this._destroyedKaijuNumber++:t.type==PlayEvent.KAIJU_EXIT&&this._aegis.damage(e.getHP()),e.dispose(),e.removeEventListener(PlayEvent.KAIJU_DESTROYED,this.onKaijuExit,this),e.removeEventListener(PlayEvent.KAIJU_EXIT,this.onKaijuExit,this);for(var i=0;i<this._kaijus.length;i++)e==this._kaijus[i]&&(this._kaijus.splice(i,1),e.dispose())},e.prototype.onAegisAction=function(t){t.type==PlayEvent.AEGIS_EMP?this._aegis.emp(this._kaijus):t.type==PlayEvent.AEGIS_MAINTAIN&&this._aegis.maintain(this._kiheis)},e.prototype.refreshStage=function(t){if(void 0===t&&(t=null),!this._pause){if(this._timeLimit-=1,this._timeLimit<=0)return this._statusBar.refreshTime(this._timeLimit),void this.onStageClear();this._timeLimit<30*this._fps&&(this.MAX_KAIJU_NUM=40,this._kaijuGenInterval=.5*this._stage.frameRate),this._timePassed+=1,this._kaijuGenTicker==this._kaijuGenInterval&&(this._kaijuGenTicker=0,this.generateKaiju()),this._kaijuGenTicker++,this._crashCheckCounter+=1;var e=!1;if(10==this._crashCheckCounter&&this._kaijus&&this._kiheis&&(this._crashCheckCounter=0,e=!0),this._kiheis)for(var i=0,n=this._kiheis;i<n.length;i++){var r=n[i];if(e&&this._kaijus)for(var a=0,s=this._kaijus;a<s.length;a++){var o=s[a],h=this.crashCheck(r,o);h&&(r.damage(2),o.damage(2),r.stopMove())}r.move(),r.onCD()}if(e&&this._statusBar.refreshHP(),this._statusBar.refreshCD(),this._timePassed==this._fps&&this._timeLimit>=0&&(this._statusBar.refreshTime(this._timeLimit),this._timePassed=0),this._kaijus)for(var l=0,c=this._kaijus;l<c.length;l++){var o=c[l];o.move()}this._aegis.refresh()}},e.prototype.crashCheck=function(t,e){if(t.isAir()){if(!(e instanceof Eagle))return!1}else if(e.isAir())return!1;var i=egret.Point.distance(new egret.Point(t.x,t.y),new egret.Point(e.x,e.y));if(i>3*this._cellSize)return!1;for(var n=e.getCollisionPoint(),r=0,a=n;r<a.length;r++){var s=a[r];if(t.hitTestPoint(s.x,s.y))return!0}return!1},e.prototype.onStageClear=function(t){void 0===t&&(t=null),this.removeEventListener(egret.Event.ENTER_FRAME,this.refreshStage,this);var e=new GameResult(!0,this._destroyedKaijuNumber,100-this._aegis.getHPrate());this.addChild(e)},e.prototype.onGameOver=function(t){void 0===t&&(t=null),this.removeEventListener(egret.Event.ENTER_FRAME,this.refreshStage,this);var e=new GameResult(!1,this._destroyedKaijuNumber,100-this._aegis.getHPrate());this.addChild(e)},e}(egret.Sprite);window.StageScene=i,__reflect(i.prototype,"StageScene",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this,i=egret.MainContext.instance.stage.stageWidth,n=egret.MainContext.instance.stage.stageHeight;e._desIndex=1;var r=new eui.Component;r.skinName="resource/eui_skins/description"+e._desIndex+".exml",e.addChild(r),e._descript=r;var a=new eui.Button;return a.width=200,a.height=100,a.x=(i-a.width)/2,a.y=n-300,a.label="下一页",a.addEventListener("touchTap",e.onNextPage,e),e.addChild(a),e._btn=a,a=new eui.Button,a.width=200,a.height=100,a.x=(i-a.width)/2,a.y=n-150,a.label="开始",a.addEventListener("touchTap",e.onStart,e),e.addChild(a),e._startBtn=a,SoundManager.instance().play("tofinalbattle_mp3"),e}return __extends(e,t),e.prototype.onNextPage=function(t){this._desIndex<4&&this._desIndex++,this._desIndex>=4&&(this._btn.visible=!1),this._descript.skinName="resource/eui_skins/description"+this._desIndex+".exml"},e.prototype.onStart=function(t){this.dispatchEvent(new egret.Event(PlayEvent.START))},e.prototype.dispose=function(){},e}(egret.Sprite);window.TitleScene=i,__reflect(i.prototype,"TitleScene",[])},function(t,e){var i=function(){function t(){}return t.getIns=function(){return t._ins||(t._ins=new t),t._ins},t.prototype.dipose=function(){},t.prototype.initMap=function(t,e,i,n,r){for(var a=[],s=[],o=0;o<e[0];o++){for(var h=[],l=0;l<e[1];l++){var c=new MapCell(l,o,n,t[o][l],!1,i[o+"_"+l]);c.x=l*n+n/2,c.y=o*n+n/2,h.push(c),o==e[0]-1&&c.isLand()&&s.push(c)}a.push(h)}this.cellArr=a,this.kaijuExit=s;for(var u=[],p=[],g=0,d=r;g<d.length;g++){var f=d[g],l=a[f[0]][f[1]];l.isLand()?p.push(l):u.push(l)}this.kaijuEntryLand=p,this.kaijuEntryAir=u},t.prototype.getKaijuExit=function(){return this.kaijuExit},t.prototype.randomEntry=function(t){var e;return e=t?this.kaijuEntryAir:this.kaijuEntryLand,e[Math.floor(Math.random()*e.length)]},t.prototype.randomExit=function(t){var e;return e=t?this.cellArr[this.cellArr.length-1]:this.kaijuExit,e[Math.floor(Math.random()*e.length)]},t.prototype.findPath=function(t,e,i){var n,r,a;if(void 0===i&&(i=null),!i){i=[];for(var s=0,o=this.cellArr;s<o.length;s++){for(var h=o[s],l=[],c=0,u=h;c<u.length;c++){var p=u[c];l.push(0)}i.push(l)}i[t.cellY][t.cellX]=1}for(var g=[],d=0,f=t.nodes;d<f.length;d++){var _=f[d];if(1!=i[_[0]][_[1]]){if(_[1]==e.cellX&&_[0]==e.cellY)return{route:(n=[t]).concat.apply(n,[this.cellArr[_[0]][_[1]]]),map:i};i[_[0]][_[1]]=1,g.push(this.cellArr[_[0]][_[1]])}}if(0==g.length)return{route:null,map:i};for(var v=null,y=[],w=0,m=i;w<m.length;w++){for(var h=m[w],E=[],S=0,A=h;S<A.length;S++){var p=A[S];E.push(p)}y.push(E)}for(var C=0,P=g;C<P.length;C++){var _=P[C],I=this.findPath(_,e,y);I.route&&(v?I.route.length<v.length&&(v=(a=[t]).concat.apply(a,I.route),i=I.map):(v=(r=[t]).concat.apply(r,I.route),i=I.map))}return{route:v,map:i}},t}();window.World=i,__reflect(i.prototype,"World",[])},function(t,e){var i=function(){function t(t){this.attackRange=1,this.damageRange=1,this.kihei=t,this.rangeSp=new ActionRange(t,this)}return t.prototype.action=function(t){},t.prototype.showAttackRange=function(t){this.rangeSp.showAttackRange(t)},t.prototype.showDamageRange=function(t,e,i){if(-1==t||-1==e)return void this.rangeSp.showDamageRange(t,e);var n=this.kihei,r=n.mapCell.getSize();if(-1!=this.attackRange){var a=r*this.attackRange,s=egret.Point.distance(new egret.Point(t,e),new egret.Point(n.x,n.y));if(s>a){var o=(e-n.y+.1)/s,h=(t-n.x+.1)/s;e=n.y+o*a,t=n.x+h*a;var l=Math.floor(e/r),c=Math.floor(t/r);this.actionTarget=i[l][c],this.rangeSp.showDamageRange(t,e)}else{var l=Math.floor(e/r),c=Math.floor(t/r);this.actionTarget=i[l][c],this.rangeSp.showDamageRange(t,e)}}else{var l=Math.floor(e/r),c=Math.floor(t/r);if(!i[l]||!i[l][c])return;this.actionTarget=i[l][c],this.rangeSp.showDamageRange(t,e)}},t.prototype.getAttackRange=function(){return this.attackRange},t.prototype.getDamageRange=function(){return this.damageRange},t.prototype.getRangeType=function(){return this.rangeType},t.prototype.getATK=function(){return this.atk},t.prototype.getCD=function(){return this.cd},t.prototype.checkInRange=function(t){return this.distanceCheck(t)?this.hitCheck(t):!1},t.prototype.distanceCheck=function(t){for(var e=t.getCollisionPoint(),i=this.rangeSp.damageRange,n=new egret.Point(i.x,i.y),r=this.damageRange*this.kihei.mapCell.getSize(),a=0,s=e;a<s.length;a++){var o=s[a],h=egret.Point.distance(o,n);if(r>h)return!0}return!1},t.prototype.hitCheck=function(t){for(var e=t.getCollisionPoint(),i=this.rangeSp.damageRange,n=0,r=e;n<r.length;n++){var a=r[n];if(i.hitTestPoint(a.x,a.y))return!0}return!1},t}();window.Skill=i,__reflect(i.prototype,"Skill",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this,e)||this;return i.attackRange=4,i.damageRange=2,i.atk=70,i.rangeType=RangeType.CIRCLE,i.cd=2*egret.MainContext.instance.stage.frameRate,i.type=KiheiSkill.JUMP_ATTACK,i}return __extends(e,t),e.prototype.action=function(e){var i=this;if(this.actionTarget){var n=this.kihei,r=this.actionTarget,a=egret.Tween.get(n).to({scaleX:1.5,scaleY:1.5,x:n.x+(r.x-n.x)/2,y:n.y+(r.y-n.y)/2},400).wait(200).to({scaleX:1,scaleY:1,x:r.x,y:r.y},200).call(function(){SoundManager.instance().playBgs("bgs_impact_mp3")}).wait(500).to({scaleX:1,scaleY:1,x:this._backCell.x,y:this._backCell.y},200).call(function(){n.mapCell=i.actionTarget,i.actionTarget=null,i.actionTween=null,n.startCD(i.cd),n.dispatchEvent(new egret.Event(PlayEvent.KIHEI_ACTION_FINISH)),t.prototype.action.call(i,e)},this);this.actionTween=a}},e.prototype.showDamageRange=function(t,e,i){if(-1==t||1==e)return void this.rangeSp.showDamageRange(-1,-1);var n=this.kihei,r=(new egret.Point(n.x,n.y),n.mapCell.getSize()),a=r*this.attackRange,s=egret.Point.distance(new egret.Point(t,e),new egret.Point(n.x,n.y));if(s>a){var o=(e-n.y+.1)/s,h=(t-n.x+.1)/s;e=n.y+o*a,t=n.x+h*a}var l=Math.floor(e/r),c=Math.floor(t/r);this.actionTarget=i[l][c];var u=i[l][c];u.isLand()||(u=this.getClosetLandCell(c,l,i)),this.rangeSp.showDamageRange(t,e),this._backCell=u},e.prototype.getClosetLandCell=function(t,e,i){for(var n=i.length,r=i[0].length,a=1;;){if(e-a>=0)for(var s=e-a,o=-a;a+1>o;o++){var h=t+o;if(!(0>h||h>=r)&&i[s][h].isLand())return i[s][h]}if(n>e+a)for(var s=e+a,o=-a;a+1>o;o++){var h=t+o;if(!(0>h||h>=r)&&i[s][h].isLand())return i[s][h]}if(t-a>=0)for(var h=t-a,o=-a;a+1>o;o++){var s=e+o;if(!(0>s||s>=n)&&i[s][h].isLand())return i[s][h]}if(r>t+a)for(var h=t+a,o=-a;a+1>o;o++){var s=e+o;if(!(0>s||s>=n)&&i[s][h].isLand())return i[s][h]}a++}},e}(Skill);window.JumpAttack=i,__reflect(i.prototype,"JumpAttack",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this,e)||this;return i.attackRange=-1,i.damageRange=4,i.atk=55,i.rangeType=RangeType.FAN,i.cd=3*egret.MainContext.instance.stage.frameRate,i.type=KiheiSkill.MISSILE,i}return __extends(e,t),e.prototype.action=function(e){var i=this;if(this.actionTarget){var n=egret.Tween.get(this.kihei).wait(1e3).call(function(){var n=i.kihei;n.mapCell=i.actionTarget,i.actionTarget=null,i.actionTween=null,n.startCD(i.cd),n.dispatchEvent(new egret.Event(PlayEvent.KIHEI_ACTION_FINISH)),t.prototype.action.call(i,e)},this);this.actionTween=n}},e}(Skill);window.Missile=i,__reflect(i.prototype,"Missile",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this,e)||this;return i.attackRange=30,i.damageRange=5,i.atk=40,i.rangeType=RangeType.CIRCLE,i.cd=2*egret.MainContext.instance.stage.frameRate,i.type=KiheiSkill.MULT_MISSILE,i}return __extends(e,t),e.prototype.action=function(e){var i=this;if(this.actionTarget){var n=egret.Tween.get(this.kihei).to({x:this.actionTarget.x,y:this.actionTarget.y},1e3).wait(1e3).call(function(){var n=i.kihei;n.mapCell=i.actionTarget,i.actionTarget=null,i.actionTween=null,n.startCD(i.cd),n.dispatchEvent(new egret.Event(PlayEvent.KIHEI_ACTION_FINISH)),t.prototype.action.call(i,e)},this);this.actionTween=n}},e}(Skill);window.MultMissile=i,__reflect(i.prototype,"MultMissile",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this,e)||this;return i._k=1,i._b=0,i.attackRange=-1,i.damageRange=2,i.atk=90,i.rangeType=RangeType.LINE,i.cd=5*egret.MainContext.instance.stage.frameRate,i.type=KiheiSkill.RAIL_GUN,i}return __extends(e,t),e.prototype.showDamageRange=function(e,i,n){var r=this.kihei;r.x==e&&(e+=.1);var a=(r.y-i)*(r.x-e)>0;this._k=Math.abs(r.y-i)/Math.abs(r.x-e),a&&(this._k*=-1),t.prototype.showDamageRange.call(this,e,i,n)},e.prototype.distanceCheck=function(t){for(var e=t.getCollisionPoint(),i=this.kihei,n=this.damageRange*this.kihei.mapCell.getSize(),r=Math.sqrt(Math.pow(this._k,2)+1),a=0,s=e;a<s.length;a++){var o=s[a],h=o.x-i.x,l=o.y-i.y,c=Math.abs(this._k*h+l)/r;if(n>c)return!0}return!1},e.prototype.action=function(e){var i=this,n=this.kihei;this.drawRailGun(),n.parent&&(n.parent.addChild(this._mask),n.parent.addChild(this._sp),this._sp.mask=this._mask,SoundManager.instance().playBgs("bgs_railgun_mp3"),this.actionTween=egret.Tween.get(this._mask).to({scaleX:200},1250).to({scaleY:0},250).call(function(){i._mask.parent.removeChild(i._mask),i._sp.parent.removeChild(i._sp),i._mask=null,i._sp=null,n.startCD(i.cd),n.dispatchEvent(new egret.Event(PlayEvent.KIHEI_ACTION_FINISH)),t.prototype.action.call(i,e)}))},e.prototype.drawRailGun=function(){var t=this.kihei,e=t.mapCell.getSize(),i=e*this.damageRange,n=new egret.Sprite;n.graphics.beginFill(16777215),n.anchorOffsetY=e/2,n.graphics.drawRect(0,0,2e3,e),n.graphics.endFill(),n.x=t.x,n.y=t.y,n.rotation=this.rangeSp.damageRange.rotation;var r=new egret.Shape;r.graphics.beginFill(16777215),r.anchorOffsetY=e/2,r.graphics.drawRoundRect(0,0,10,e,i,i),r.graphics.endFill(),r.x=t.x,r.y=t.y,r.rotation=this.rangeSp.damageRange.rotation,this._mask=r,this._sp=n;var a=new egret.GlowFilter(8900331,.3,20,20,20,1,!0,!1);n.filters=[a]},e}(Skill);window.RailGun=i,__reflect(i.prototype,"RailGun",[])},function(t,e){var i=function(){function t(t,e){this._kihei=t,this._skill=e}return t.prototype.showAttackRange=function(t){-1!=this._skill.getAttackRange()&&this._isShowAttackRange!=t&&(this.attackRange||this.drawRange1(),t&&!this.attackRange.parent?this._kihei.addChild(this.attackRange):!t&&this.attackRange.parent&&this._kihei.removeChild(this.attackRange),this._isShowAttackRange=t)},t.prototype.showDamageRange=function(t,e){if((-1==t||1==e)&&this.damageRange)return void(this.damageRange.parent&&this.damageRange.parent.removeChild(this.damageRange));this.damageRange||this.drawRange2();var i=this._kihei,n=this._skill,r=n.getAttackRange(),a=this.damageRange;if(-1!=r){var s=this.alphaKihei;s||(s=i.drawKihei(),s.alpha=.5,this.alphaKihei=s),s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2,s.x=0,s.y=0,a.x=t,a.y=e,a.addChild(s),i.parent&&i.parent.addChild(a)}else{a.x=i.x,a.y=i.y;var o=GlobalMethod.getRotation(i.x,i.y,t,e);n.getRangeType()==RangeType.FAN&&(o-=60),a.rotation=o,i.parent&&i.parent.addChild(a)}},t.prototype.drawRange1=function(){var t=this._skill.getAttackRange();if(-1!=t){var e=this._kihei.mapCell.getSize(),i=new egret.Sprite;i.graphics.beginFill(13444646,.2),i.graphics.drawCircle(e/2,e/2,e*t),i.graphics.endFill(),this.attackRange=i}},t.prototype.drawRange2=function(){var t=this._kihei,e=this._skill,i=t.mapCell.getSize(),n=e.getDamageRange(),r=e.getRangeType(),a=new egret.Sprite;switch(r){case RangeType.CIRCLE:a.graphics.beginFill(15608876,.5),a.graphics.drawCircle(0,0,i*n);break;case RangeType.FAN:var s=i*n;a.graphics.beginGradientFill(egret.GradientType.RADIAL,[15608876,15608876],[0,.6],[1,35],new egret.Matrix),a.graphics.moveTo(0,0),a.graphics.lineTo(s,0),a.graphics.drawArc(0,0,s,0,120*Math.PI/180),a.graphics.lineTo(0,0);break;case RangeType.LINE:new egret.Matrix;a.graphics.beginGradientFill(egret.GradientType.LINEAR,[15608876,15608876],[0,.6],[130,155],new egret.Matrix),a.anchorOffsetY=n*i/2,a.graphics.drawRect(0,0,30*i,n*i)}a.graphics.endFill(),this.damageRange=a},t}();window.ActionRange=i,__reflect(i.prototype,"ActionRange",[])},function(t,e){var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="resource/eui_skins/confirmbtn.exml",e}return __extends(e,t),e}(eui.Button);window.ConfirmBtn=i,__reflect(i.prototype,"ConfirmBtn",[])},function(t,e){var i=function(t){function e(e,i,n){void 0===n&&(n=10);var r=t.call(this)||this;return r._w=i,r.height=n,r.width=i,r.value=100,r.drawBase(),r}return __extends(e,t),e.prototype.drawBase=function(){var t=new egret.Sprite;t.graphics.beginFill(16711680,.1),t.graphics.drawRect(0,0,this._w,this.height),t.graphics.endFill(),this.addChildAt(t,0)},e}(eui.ProgressBar);window.SimpleHPBar=i,__reflect(i.prototype,"SimpleHPBar",[])},function(t,e){var i=function(t){function e(e){var i=t.call(this)||this;return i._kihei=e,i.addEventListener(eui.UIEvent.ADDED_TO_STAGE,i.init,i),i.skinName="resource/eui_skins/KiheiStatus.exml",i._kihei.addEventListener(PlayEvent.GET_DAMAGE,i.refreshHP,i),i}return __extends(e,t),e.prototype.init=function(t){this.kihei_icon&&(this._iconSize=this.width),this.refresh()},e.prototype.refresh=function(t){void 0===t&&(t=null);var e=this._kihei;if(!this._sp){var i=e.drawKihei(),n=i.width/i.height;i.width=this.width,i.height=i.width/n,i.y=(this._iconSize-i.height)/2,this._sp=i,this.kihei_icon.addChild(i)}this.refreshHP(),this.refreshCD()},e.prototype.refreshHP=function(t){void 0===t&&(t=null),this.hp_gauge&&(this.hp_gauge.value=this._kihei.getHP()/this._kihei.getMaxHP()*100)},e.prototype.refreshCD=function(){if(this.kihei_icon){var t=360*this._kihei.getCDRate();if(360==t)return void(this._iscd&&this._cdProgress&&(this._cdProgress.graphics.clear(),this._iscd=!1));this._iscd=!0;var e=this.width,i=e/2,n=this._cdProgress,r=this._mask;n||(n=new egret.Shape,n.x=0,n.y=0,this._cdProgress=n,this.kihei_icon.addChild(n)),r||(r=new egret.Shape,r.graphics.beginFill(0),r.graphics.drawRect(0,0,e,e),r.graphics.endFill(),this.kihei_icon.addChild(r)),n.graphics.clear(),n.graphics.beginFill(0,.7),n.graphics.moveTo(i,i),n.graphics.lineTo(e,e),n.graphics.drawArc(i,i,e,0,t*Math.PI/180,!0),n.graphics.lineTo(i,i),n.graphics.endFill(),n.mask=r}},e}(eui.Component);window.Status=i,__reflect(i.prototype,"Status",[])},function(t,e){var i=function(t){function e(e,i){var n=t.call(this)||this;return n._fps=egret.MainContext.instance.stage.frameRate,n._aegis=e,e.addEventListener(PlayEvent.AEGIS_DAMAGE,n.onAegisDamage,n),e.addEventListener(PlayEvent.AEGIS_MAINTAIN_FINISH,n.onAegisAction,n),e.addEventListener(PlayEvent.AEGIS_EMP_DID,n.onAegisAction,n),n._kiheis=i,n.addEventListener(eui.UIEvent.ADDED_TO_STAGE,n.onAdded,n),n.skinName="resource/eui_skins/TotalStatus.exml",n}return __extends(e,t),e.prototype.onAdded=function(t){var e=this;this.alpha=0,setTimeout(function(){e.init()},1e3)},e.prototype.init=function(t){var e=this;void 0===t&&(t=null);for(var i=[],n=egret.MainContext.instance.stage.stageHeight,r=egret.MainContext.instance.stage.stageWidth,a=this._kiheis,s=(r-20)/5,o=1.2*s,h=0;h<a.length;h++){var l=a[h],c=new Status(l);i.push(c),c.width=s,c.height=o,this.status_container.addChild(c)}return this._kiheiStatus=i,this.x=0,this.height=n,this.btn_emp.addEventListener("touchTap",function(t){e.dispatchEvent(new egret.Event(PlayEvent.AEGIS_EMP))},this),this.btn_maintain.addEventListener("touchTap",function(t){e.dispatchEvent(new egret.Event(PlayEvent.AEGIS_MAINTAIN))},this),this.alpha=1,!0},e.prototype.refreshHP=function(){if(this._kiheiStatus)for(var t=0,e=this._kiheiStatus;t<e.length;t++){var i=e[t];i.refreshHP()}},e.prototype.refreshCD=function(){if(this._kiheiStatus)for(var t=0,e=this._kiheiStatus;t<e.length;t++){var i=e[t];i.refreshCD()}},e.prototype.refreshTime=function(t){var e=t/this._fps,i=Math.floor(e/60),n=e%60;this.txt_time.text=i+":"+(10>n?"0"+n:n)},e.prototype.setTips=function(t){this.txt_tips.text=t},e.prototype.onAegisDamage=function(t){var e=this._aegis.getHPrate();this.aegis_hp.value=e,30>e&&(this.aegis_hp.tint=16711680)},e.prototype.onAegisAction=function(t){t.type==PlayEvent.AEGIS_MAINTAIN_FINISH?(this.btn_maintain.visible=!1,this.refreshHP()):t.type==PlayEvent.AEGIS_EMP_DID&&(this.btn_emp.visible=!1)},e}(eui.Component);window.StatusBar=i,__reflect(i.prototype,"StatusBar",[])},function(t,e){var i=function(){function t(){}return t}();window.Dialog=i,__reflect(i.prototype,"Dialog",[])},function(t,e){var i=function(){function t(){}return t.regist=function(){t.map.ticker=new n(function(){egret.ticker.pause()},function(){egret.ticker.resume()}),egret.lifecycle.onPause=this.onPause,egret.lifecycle.onResume=this.onResume},t.addFunc=function(e,i,r){t.map[e]=new n(i,r)},t.removeFunc=function(e){delete t.map[e]},t.onPause=function(){for(var e in t.map)t.map[e].onPause()},t.onResume=function(){for(var e in t.map)t.map[e].onResume()},t.map={},t}();window.LifecycleCallback=i,__reflect(i.prototype,"LifecycleCallback",[]);var n=function(){function t(t,e){this.onPause=t,this.onResume=e}return t}();window.LcyObj=n,__reflect(n.prototype,"LcyObj",[])},function(t,e){var i=function(){function t(){this._dict={}}return t.prototype.addRoute=function(t,e,i,n,r){for(var a=t+"_"+e+"_"+i+"_"+n,s=[],o=0,h=r;o<h.length;o++){var l=h[o];s.push([l.cellX,l.cellY])}this._dict[a]==s},t.prototype.checkRoute=function(t,e,i,n,r){void 0===r&&(r=!1);var a=t+"_"+e+"_"+i+"_"+n;if(this._dict[a])return console.log("已缓存当前路径"),this._dict[a];var s=World.getIns().cellArr,o=s[e][t],h=s[n][i],l=World.getIns().findPath(o,h,null);return r&&this._dict[a]==l,l},t.prototype.checkRoute2=function(t,e,i){void 0===i&&(i=!1);var n=t.cellX+"_"+t.cellY+"_"+e.cellX+"_"+e.cellY;if(this._dict[n])return console.log("已缓存当前路径"),this._dict[n];var r=World.getIns().findPath(t,e,null);return i&&this._dict[n]==r,r},t}();window.RouteDict=i,__reflect(i.prototype,"RouteDict",[])},function(t,e){var i=function(){function t(){var t=this;LifecycleCallback.addFunc("bgm",function(){t.pause()},function(){t.resume()}),this._bgs={}}return t.instance=function(){return t._ins||(t._ins=new t),t._ins},t.prototype.play=function(t,e){void 0===e&&(e=!0),this._bgm&&(this._bgmChannel.stop(),this._bgm.close()),this._bgm=RES.getRes(t),this._bgm.type=egret.Sound.MUSIC,this._bgmChannel=this._bgm.play(0,e?0:1)},t.prototype.playBgs=function(t){var e;e=this._bgs[t]?this._bgs[t]:RES.getRes(t),e.play(0,1)},t.prototype.resume=function(){this._bgm&&(this._bgmChannel=this._bgm.play(this._bgmPosition))},t.prototype.pause=function(){this._bgm&&(this._bgmPosition=this._bgmChannel.position,this._bgmChannel.stop())},t}();window.SoundManager=i,__reflect(i.prototype,"SoundManager",[])}]);